{"ast":null,"code":"import _classCallCheck from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/billbuff/projects/academy/capstone/ProperT-react/src/App.jsx\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport store from 'store';\nimport { BrowserRouter as Router, Route, Redirect } from 'react-router-dom';\nimport LDClient from 'ldclient-js';\nimport Landing from './components/Landing';\nimport AccountManagement from './components/AccountManagement';\nimport PropertyDetails from './components/PropertyDetails';\nimport Nav from './components/Nav';\nimport Footer from './components/Footer';\nimport { fetchRentals } from './store/actions/rentalsActions';\nimport './App.css';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this));\n\n    _this.componentDidMount = function () {\n      var isLoggedIn = _this.state.isLoggedIn;\n\n      if (isLoggedIn) {\n        _this.checkTokenStatus();\n\n        fetchRentals();\n      }\n\n      var user = {\n        key: 'allusers'\n      };\n      _this.ldclient = LDClient.initialize('5c08a03c1412625ab643f790', user);\n\n      _this.ldclient.on('ready', _this.onLaunchDarklyReady.bind(_assertThisInitialized(_assertThisInitialized(_this))));\n    };\n\n    _this.onLaunchDarklyReady = function () {\n      _this.setState({\n        featureFlags: {\n          googleAuthEnabled: _this.ldclient.variation('propert-google-auth')\n        }\n      });\n    };\n\n    _this.checkTokenStatus = function () {\n      axios.get('http://127.0.0.1:3001/auth/verify', {\n        headers: {\n          'x-access-token': sessionStorage.getItem('jwt_token')\n        }\n      }) // eslint-disable-next-line no-console\n      .then(function () {\n        return console.log('Token is valid');\n      }).catch(function () {\n        _this.handleLogout(); // eslint-disable-next-line no-alert\n\n\n        alert('Your session has expired please sign in again');\n      });\n      return false;\n    };\n\n    _this.handleLoggedInUser = function () {\n      _this.setState({\n        isLoggedIn: true\n      });\n    };\n\n    _this.updateCurrentRental = function (rental) {\n      var currentRental = _this.state.currentRental;\n\n      var rentalEdited = _.isEqual(currentRental, rental);\n\n      if (!rentalEdited) {\n        _this.getAllRentals();\n      }\n\n      store.set('currentRental', rental);\n\n      _this.setState({\n        currentRental: store.get('currentRental')\n      });\n    };\n\n    _this.handleLogout = function () {\n      sessionStorage.removeItem('jwt_token');\n\n      _this.setState({\n        isLoggedIn: false\n      });\n\n      sessionStorage.clear();\n      store.clearAll();\n    };\n\n    var loginStatus = !!sessionStorage.getItem('jwt_token');\n    _this.state = {\n      isLoggedIn: loginStatus,\n      currentRental: store.get('currentRental') || {}\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      // eslint-disable-next-line object-curly-newline\n      var _this$state = this.state,\n          isLoggedIn = _this$state.isLoggedIn,\n          currentRental = _this$state.currentRental,\n          rentals = _this$state.rentals,\n          featureFlags = _this$state.featureFlags;\n      return React.createElement(Router, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88\n        },\n        __self: this\n      }, React.createElement(Nav, {\n        currentRental: currentRental,\n        updateCurrentRental: this.updateCurrentRental,\n        isLoggedIn: isLoggedIn,\n        handleLogout: this.handleLogout,\n        rentals: rentals,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }), React.createElement(\"main\", {\n        id: \"main\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96\n        },\n        __self: this\n      }, React.createElement(Route, {\n        exact: true,\n        path: \"/\",\n        render: function render(props) {\n          return React.createElement(Landing, Object.assign({}, props, {\n            isLoggedIn: isLoggedIn,\n            handleLoggedInUser: _this2.handleLoggedInUser,\n            featureFlags: featureFlags,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 101\n            },\n            __self: this\n          }));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/user\",\n        render: function render() {\n          return isLoggedIn ? React.createElement(AccountManagement, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 113\n            },\n            __self: this\n          }) : React.createElement(Redirect, {\n            to: \"/\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 114\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/rentals/:id/\",\n        render: function render(props) {\n          return isLoggedIn ? React.createElement(PropertyDetails, Object.assign({}, props, {\n            currentRental: currentRental,\n            updateCurrentRental: _this2.updateCurrentRental,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 122\n            },\n            __self: this\n          })) : React.createElement(Redirect, {\n            to: \"/\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 127\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      })), React.createElement(Footer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    rentals: state.rentals\n  };\n};\n\nexport default connect(mapStateToProps, {\n  fetchRentals: fetchRentals\n})(App);","map":{"version":3,"sources":["/Users/billbuff/projects/academy/capstone/ProperT-react/src/App.jsx"],"names":["React","Component","connect","axios","_","store","BrowserRouter","Router","Route","Redirect","LDClient","Landing","AccountManagement","PropertyDetails","Nav","Footer","fetchRentals","App","componentDidMount","isLoggedIn","state","checkTokenStatus","user","key","ldclient","initialize","on","onLaunchDarklyReady","bind","setState","featureFlags","googleAuthEnabled","variation","get","headers","sessionStorage","getItem","then","console","log","catch","handleLogout","alert","handleLoggedInUser","updateCurrentRental","rental","currentRental","rentalEdited","isEqual","getAllRentals","set","removeItem","clear","clearAll","loginStatus","rentals","props","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport store from 'store';\nimport { BrowserRouter as Router, Route, Redirect } from 'react-router-dom';\nimport LDClient from 'ldclient-js';\nimport Landing from './components/Landing';\nimport AccountManagement from './components/AccountManagement';\nimport PropertyDetails from './components/PropertyDetails';\nimport Nav from './components/Nav';\nimport Footer from './components/Footer';\nimport { fetchRentals } from './store/actions/rentalsActions';\nimport './App.css';\n\nclass App extends Component {\n  constructor() {\n    super();\n    const loginStatus = !!sessionStorage.getItem('jwt_token');\n    this.state = {\n      isLoggedIn: loginStatus,\n      currentRental: store.get('currentRental') || {},\n    };\n  }\n\n  componentDidMount = () => {\n    const { isLoggedIn } = this.state;\n    if (isLoggedIn) {\n      this.checkTokenStatus();\n      fetchRentals();\n    }\n    const user = {\n      key: 'allusers',\n    };\n    this.ldclient = LDClient.initialize('5c08a03c1412625ab643f790', user);\n    this.ldclient.on('ready', this.onLaunchDarklyReady.bind(this));\n  }\n\n  onLaunchDarklyReady = () => {\n    this.setState({\n      featureFlags: { googleAuthEnabled: this.ldclient.variation('propert-google-auth') },\n    });\n  }\n\n  checkTokenStatus = () => {\n    axios.get('http://127.0.0.1:3001/auth/verify', {\n      headers: { 'x-access-token': sessionStorage.getItem('jwt_token') },\n    })\n      // eslint-disable-next-line no-console\n      .then(() => console.log('Token is valid'))\n      .catch(() => {\n        this.handleLogout();\n        // eslint-disable-next-line no-alert\n        alert('Your session has expired please sign in again');\n      });\n\n    return false;\n  }\n\n  handleLoggedInUser = () => {\n    this.setState({\n      isLoggedIn: true,\n    });\n  }\n\n  updateCurrentRental = (rental) => {\n    const { currentRental } = this.state;\n    const rentalEdited = _.isEqual(currentRental, rental);\n    if (!rentalEdited) {\n      this.getAllRentals();\n    }\n    store.set('currentRental', rental);\n    this.setState({ currentRental: store.get('currentRental') });\n  }\n\n  handleLogout = () => {\n    sessionStorage.removeItem('jwt_token');\n    this.setState({ isLoggedIn: false });\n    sessionStorage.clear();\n    store.clearAll();\n  }\n\n  render() {\n    // eslint-disable-next-line object-curly-newline\n    const { isLoggedIn, currentRental, rentals, featureFlags } = this.state;\n    return (\n      <Router>\n        <div className=\"App\">\n          <Nav\n            currentRental={currentRental}\n            updateCurrentRental={this.updateCurrentRental}\n            isLoggedIn={isLoggedIn}\n            handleLogout={this.handleLogout}\n            rentals={rentals}\n          />\n          <main id=\"main\">\n            <Route\n              exact\n              path=\"/\"\n              render={props => (\n                <Landing\n                  {...props}\n                  isLoggedIn={isLoggedIn}\n                  handleLoggedInUser={this.handleLoggedInUser}\n                  featureFlags={featureFlags}\n                />\n              )}\n            />\n            <Route\n              path=\"/user\"\n              render={() => (\n                isLoggedIn\n                  ? <AccountManagement />\n                  : <Redirect to=\"/\" />\n              )}\n            />\n            <Route\n              path=\"/rentals/:id/\"\n              render={props => (\n                isLoggedIn\n                  ? (\n                    <PropertyDetails\n                      {...props}\n                      currentRental={currentRental}\n                      updateCurrentRental={this.updateCurrentRental}\n                    />)\n                  : <Redirect to=\"/\" />\n              )}\n            />\n          </main>\n          <Footer />\n        </div>\n      </Router>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  rentals: state.rentals,\n});\n\nexport default connect(mapStateToProps, { fetchRentals })(App);\n"]},"metadata":{},"sourceType":"module"}