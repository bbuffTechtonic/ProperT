{"ast":null,"code":"import _regeneratorRuntime from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/billbuff/projects/academy/capstone/ProperT-react/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/billbuff/projects/academy/capstone/ProperT-react/src/App.jsx\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport store from 'store';\nimport { BrowserRouter as Router, Route, Redirect } from 'react-router-dom';\nimport LDClient from 'ldclient-js';\nimport { fetchRentals } from './store/actions/rentalsActions';\nimport Landing from './components/Landing';\nimport AccountManagement from './components/AccountManagement';\nimport PropertyDetails from './components/PropertyDetails';\nimport Nav from './components/Nav';\nimport Footer from './components/Footer';\nimport './App.css';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this));\n    _this.componentDidMount =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var isLoggedIn, fetchRentals, user;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              isLoggedIn = _this.state.isLoggedIn; // eslint-disable-next-line no-shadow\n\n              fetchRentals = _this.props.fetchRentals;\n              _context.next = 4;\n              return fetchRentals();\n\n            case 4:\n              console.log(_this.props);\n\n              if (isLoggedIn) {\n                _this.checkTokenStatus();\n              }\n\n              user = {\n                key: 'allusers'\n              };\n              _this.ldclient = LDClient.initialize('5c08a03c1412625ab643f790', user);\n\n              _this.ldclient.on('ready', _this.onLaunchDarklyReady.bind(_assertThisInitialized(_assertThisInitialized(_this))));\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    _this.onLaunchDarklyReady = function () {\n      _this.setState({\n        featureFlags: {\n          googleAuthEnabled: _this.ldclient.variation('propert-google-auth')\n        }\n      });\n    };\n\n    _this.checkTokenStatus = function () {\n      axios.get('http://127.0.0.1:3001/auth/verify', {\n        headers: {\n          'x-access-token': sessionStorage.getItem('jwt_token')\n        }\n      }) // eslint-disable-next-line no-console\n      .then(function () {\n        return console.log('Token is valid');\n      }).catch(function () {\n        _this.handleLogout(); // eslint-disable-next-line no-alert\n\n\n        alert('Your session has expired please sign in again');\n      });\n      return false;\n    };\n\n    _this.handleLoggedInUser = function () {\n      _this.setState({\n        isLoggedIn: true\n      });\n    };\n\n    _this.updateCurrentRental = function (rental) {\n      var currentRental = _this.state.currentRental;\n\n      var rentalEdited = _.isEqual(currentRental, rental);\n\n      if (!rentalEdited) {\n        _this.getAllRentals();\n      }\n\n      store.set('currentRental', rental);\n\n      _this.setState({\n        currentRental: store.get('currentRental')\n      });\n    };\n\n    _this.handleLogout = function () {\n      sessionStorage.removeItem('jwt_token');\n\n      _this.setState({\n        isLoggedIn: false\n      });\n\n      sessionStorage.clear();\n      store.clearAll();\n    };\n\n    var loginStatus = !!sessionStorage.getItem('jwt_token');\n    _this.state = {\n      isLoggedIn: loginStatus,\n      currentRental: store.get('currentRental') || {}\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      // eslint-disable-next-line object-curly-newline\n      var _this$state = this.state,\n          isLoggedIn = _this$state.isLoggedIn,\n          currentRental = _this$state.currentRental,\n          featureFlags = _this$state.featureFlags;\n      var rentals = this.props.rentals;\n      return React.createElement(Router, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92\n        },\n        __self: this\n      }, React.createElement(\"main\", {\n        id: \"main\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }, React.createElement(Route, {\n        exact: true,\n        path: \"/\",\n        render: function render(props) {\n          return React.createElement(Landing, Object.assign({}, props, {\n            isLoggedIn: isLoggedIn,\n            handleLoggedInUser: _this2.handleLoggedInUser,\n            featureFlags: featureFlags,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 105\n            },\n            __self: this\n          }));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/user\",\n        render: function render() {\n          return isLoggedIn ? React.createElement(AccountManagement, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 117\n            },\n            __self: this\n          }) : React.createElement(Redirect, {\n            to: \"/\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 118\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/rentals/:id/\",\n        render: function render(props) {\n          return isLoggedIn ? React.createElement(PropertyDetails, Object.assign({}, props, {\n            currentRental: currentRental,\n            updateCurrentRental: _this2.updateCurrentRental,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 126\n            },\n            __self: this\n          })) : React.createElement(Redirect, {\n            to: \"/\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 131\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      })), React.createElement(Footer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    rentals: state.rentals\n  };\n};\n\nexport default connect(mapStateToProps, {\n  fetchRentals: fetchRentals\n})(App);","map":{"version":3,"sources":["/Users/billbuff/projects/academy/capstone/ProperT-react/src/App.jsx"],"names":["React","Component","connect","axios","_","store","BrowserRouter","Router","Route","Redirect","LDClient","fetchRentals","Landing","AccountManagement","PropertyDetails","Nav","Footer","App","componentDidMount","isLoggedIn","state","props","console","log","checkTokenStatus","user","key","ldclient","initialize","on","onLaunchDarklyReady","bind","setState","featureFlags","googleAuthEnabled","variation","get","headers","sessionStorage","getItem","then","catch","handleLogout","alert","handleLoggedInUser","updateCurrentRental","rental","currentRental","rentalEdited","isEqual","getAllRentals","set","removeItem","clear","clearAll","loginStatus","rentals","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport _ from 'lodash';\nimport store from 'store';\nimport { BrowserRouter as Router, Route, Redirect } from 'react-router-dom';\nimport LDClient from 'ldclient-js';\nimport { fetchRentals } from './store/actions/rentalsActions';\nimport Landing from './components/Landing';\nimport AccountManagement from './components/AccountManagement';\nimport PropertyDetails from './components/PropertyDetails';\nimport Nav from './components/Nav';\nimport Footer from './components/Footer';\nimport './App.css';\n\nclass App extends Component {\n  constructor() {\n    super();\n    const loginStatus = !!sessionStorage.getItem('jwt_token');\n    this.state = {\n      isLoggedIn: loginStatus,\n      currentRental: store.get('currentRental') || {},\n    };\n  }\n\n  componentDidMount = async () => {\n    const { isLoggedIn } = this.state;\n    // eslint-disable-next-line no-shadow\n    const { fetchRentals } = this.props;\n    await fetchRentals();\n    console.log(this.props)\n    if (isLoggedIn) {\n      this.checkTokenStatus();\n    }\n    const user = {\n      key: 'allusers',\n    };\n    this.ldclient = LDClient.initialize('5c08a03c1412625ab643f790', user);\n    this.ldclient.on('ready', this.onLaunchDarklyReady.bind(this));\n  }\n\n  onLaunchDarklyReady = () => {\n    this.setState({\n      featureFlags: { googleAuthEnabled: this.ldclient.variation('propert-google-auth') },\n    });\n  }\n\n  checkTokenStatus = () => {\n    axios.get('http://127.0.0.1:3001/auth/verify', {\n      headers: { 'x-access-token': sessionStorage.getItem('jwt_token') },\n    })\n      // eslint-disable-next-line no-console\n      .then(() => console.log('Token is valid'))\n      .catch(() => {\n        this.handleLogout();\n        // eslint-disable-next-line no-alert\n        alert('Your session has expired please sign in again');\n      });\n\n    return false;\n  }\n\n  handleLoggedInUser = () => {\n    this.setState({\n      isLoggedIn: true,\n    });\n  }\n\n  updateCurrentRental = (rental) => {\n    const { currentRental } = this.state;\n    const rentalEdited = _.isEqual(currentRental, rental);\n    if (!rentalEdited) {\n      this.getAllRentals();\n    }\n    store.set('currentRental', rental);\n    this.setState({ currentRental: store.get('currentRental') });\n  }\n\n  handleLogout = () => {\n    sessionStorage.removeItem('jwt_token');\n    this.setState({ isLoggedIn: false });\n    sessionStorage.clear();\n    store.clearAll();\n  }\n\n  render() {\n    // eslint-disable-next-line object-curly-newline\n    const { isLoggedIn, currentRental, featureFlags } = this.state;\n    const { rentals } = this.props;\n    return (\n      <Router>\n        <div className=\"App\">\n          {/* <Nav\n            currentRental={currentRental}\n            updateCurrentRental={this.updateCurrentRental}\n            isLoggedIn={isLoggedIn}\n            handleLogout={this.handleLogout}\n            rentals={rentals}\n          /> */}\n          <main id=\"main\">\n            <Route\n              exact\n              path=\"/\"\n              render={props => (\n                <Landing\n                  {...props}\n                  isLoggedIn={isLoggedIn}\n                  handleLoggedInUser={this.handleLoggedInUser}\n                  featureFlags={featureFlags}\n                />\n              )}\n            />\n            <Route\n              path=\"/user\"\n              render={() => (\n                isLoggedIn\n                  ? <AccountManagement />\n                  : <Redirect to=\"/\" />\n              )}\n            />\n            <Route\n              path=\"/rentals/:id/\"\n              render={props => (\n                isLoggedIn\n                  ? (\n                    <PropertyDetails\n                      {...props}\n                      currentRental={currentRental}\n                      updateCurrentRental={this.updateCurrentRental}\n                    />)\n                  : <Redirect to=\"/\" />\n              )}\n            />\n          </main>\n          <Footer />\n        </div>\n      </Router>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  rentals: state.rentals,\n});\n\nexport default connect(mapStateToProps, { fetchRentals })(App);\n"]},"metadata":{},"sourceType":"module"}